# weixin_chat
简单的微信聊天室，目前支持发送消息和图片（支持预览）

第一次写小程序，老板就让我用websoket写个聊天对话，群聊这种。第一次写聊天功能，第一次用websoket,第一次用小程序，这是在考验我吗？委屈不过我还是研究了一下，终于实现了。偷笑

首先看一下界面，界面很简单，就是首页刚进来获取了用户信息头像，昵称等。点击进入聊天室就可以聊天了,下面我介绍的是前端代码实现，后台需要做的很简单，就是你给他发送什么数据，他就给你返回什么数据，就是在接收前台发送过来的图片的时候需要做个格式转换，因为有时候前端将接收到的json字符串转换json对象的时候，遇到有特殊的标点符号可能会报错，比如我就是‘\’报的错，找了半天。

    因为有人咨询，所以附上所有小程序代码，地址：https://github.com/chongwenwen/weixin_chat/tree/master

    有人说为什么没有utile.js的代码，这个功能只用到websoket.js跟utile.js没有关系哦！还有后台代码在页面最底下

         


文档目录结构如下：（聊天页面为chat）

  

 

chat.wxml页面

      首先写好页面结构,既然是群聊功能，肯定有自己和别人，所以页面的view盒子应给有两部分，一个内容左侧显示，一个内容右侧显示，下面是代码，因为没有正式注册企业项目，我用的服务器都是本地的服务器，所以界面区分别人和我的聊天信息是用昵称区分的，如果正式项目应该是由一个用户标记去区分的

  
 

websoket.js文件

      在utils目录下,是封装了websoket的请求过程，以便在chat.js中调用。需要注意的是wx.connectSocket代表客户端首次和服务器建立联系，wx.onSocketOpen才是正式打开通道，wx.onSocketMessage必须在 wx.onSocketOpen 回调之后发送才生效。

wx.onSocketMessage里面带有参数是一个函数回调，这个回调就是后台服务器实时接收并返给前台的数据

  

chat.js文件

聊天室的逻辑操作页面，websocket.connect（）{}调用的是websocket.js封装好的websoket的逻辑函数，回调就是后台的数据，之所以在本页面调用就是方便接收以后的逻辑操作。我建立文件的时候用的就是微信官方的快速模板生成的，所以app.js里面没有变动，用户在chat.js获取userInfo的时候可以引用全局的app.globalData.userInfo

 

还有要注意的一点就是在选择发送图片的时候，必须是先把本地的图片地址发送给后台，转换成服务器的图片地址再次通过wensoket.send发送给服务器，这个时候服务器推送给其他用户的才是正确的地址，否则你的本地地址其他用户是访问不到的。

 

--------------------- 
作者：chongwenwen 
来源：CSDN 
原文：https://blog.csdn.net/weixin_41326021/article/details/81004981 
版权声明：本文为博主原创文章，转载请附上博文链接！
